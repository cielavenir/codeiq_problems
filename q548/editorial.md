2013年11月12日～2013年12月9日の期間、Detect Music Keyという音階検出問題を出題しました。
33名の方が挑戦してくださいました。

## 言語統計
* Ruby 13名
* Python 5名
* Perl 3名
* C 2名
* C++ 2名
* C\# 2名
* D 1名
* JavaScript 1名
* PHP 1名
* Scala 1名
* VBA 1名
* なでしこ 1名

## データセット等
<https://github.com/cielavenir/codeiq_problems/tree/master/q548>
で公開しています。
ランダム生成ですが、そのままだとinvalidの率が高くなるため若干調整しています。

00modulatekey.rbは最初に作った問題（「与えられた音のリストを転調しなさい」という問題）の解答で、5行で解答できてしまったため、それを取り下げたときの残骸です。

## 想定解
私の想定解(上記URLでRubyとC++による解答を用意しています)は以下のとおりです。

- 音の一覧を取得し、重複を削る
- 12の主音に対し、対応する音階に含まれない音が入っているか調べる

後半の探索は2重ループとなります。
今回は(音の)種類が小さいので十分ですが、これより速い解法が存在します。

## ビットマップ演算
長調の音階は

~~~rb
0b101010110101
~~~

と表すことができます。
音の一覧を数値に保持した上で、上記ビットパターンを左回転( (n&lt;&lt;i)|(n&gt;&gt;(12-i)) )してビット積を取ることで1重ループで探索することができます(detectmusickey_fast.rb)。
また前半の重複を削るのも、ビット和を取るだけなので高速化することができます。
4名の方がこの方法で解答してくださいました。

ヒントをツイートしたのは締め切り1週間前、問題文に加筆したのは締め切り数日前となってしまいました。
これは、音階を保持する方法が、booleanの配列、数値の配列、ビットパターンといろいろあるために、あまり縛りたくなかったというのが理由でした。
しかしながら逆効果だったようです。もう少し早く追加しておくべきだったなと思っています。

## お詫び
音名をCsと表記するのは微妙なのでC\#とするべきであるという意見を賜りました。
確かにそうだったと思います。
\#はASCII文字ですから嫌う必要もありませんしね…。

## 解答紹介
* なでしこでの挑戦があったのが個人的に嬉しかったので、紹介 (アーカイブでは割愛させていただきます)

## 問題文
音楽は次に挙げる12音で構成されています。

> C Cs D Ds E F Fs G Gs A As B

また、楽曲には調性があり、(転調がある場合その前後それぞれで)12音中決まった7音が使われます。
主音を軸として、各音がこの7音に含まれるかどうかは

~~~cpp
true,false,true,false,true,true,false,true,false,true,false,true
~~~

と表されます。
音のリストが与えられるので、その音が全て含まれうる音階(調)(の主音)を答えて下さい。
なお、今回は長調のみを考えるものとします。

例えば、ハ長調で使われる音は

> C D E F G A B

で、その主音は **C** です。

[入力]

```
T
N1
Key1 Key2 … keyN1
…
NT
Key1 Key2 … keyNT
```

先頭行はデータセットの数Tが入ります。
続くT&lowast;2行は各データセットからなります。1行目は音のリストの数、2行目は音のリストです。
含まれうる音のリストは以下のとおりです。

>C Cs D Ds E F Fs G Gs A As B

[出力]
その音が全て含まれうる音階(の主音)を、上記リストの順番(CからB)で空白で区切って出力して下さい。
該当する音階がない場合はinvalidと出力して下さい。

[サンプル]
サンプル(sample.in)は、

```
5
1
C
7
C D E F G A B
10
A B C D E F G A B C
8
C Cs D E F G A B
3
C Cs Fs
```

となっています。これに対応する出力は、

```
C Cs Ds F G Gs As
C
C
invalid
Cs
```

となります(sample.ans)。(公開当初のsample.ansは誤っていました。申し訳ございません)
音の数が7未満でも音階が決まりうる場合に注意して下さい。

解答方法及びデータセットは、(アーカイブから取得してください)
data.inに対する解答を、answer.txtを熟読の上提出して下さい。
